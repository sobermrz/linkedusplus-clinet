{"ast":null,"code":"import _slicedToArray from\"/Users/andrew/mern-workspace/linkedUs/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState,useRef}from'react';import{connect}from'react-redux';import PropTypes from'prop-types';import{connectWebSocket,sendMessage,disconnectWebSocket}from'../../actions/chat';import Incoming_msg from'./Incoming_msg';import Outgoing_msg from'./Outgoing_msg';var Mesgs=function Mesgs(_ref){var user=_ref.user,isAuthenticated=_ref.isAuthenticated,socket=_ref.socket,msgData=_ref.msgData,loading=_ref.loading,connectWebSocket=_ref.connectWebSocket,sendMessage=_ref.sendMessage,nowTalkingTo=_ref.nowTalkingTo;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),ws=_useState2[0],setWs=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),msg=_useState4[0],setMsg=_useState4[1];var msgButton=useRef(null);var executeScroll=function executeScroll(){msgButton.current.scrollIntoView();};useEffect(function(){if(loading&&isAuthenticated){connectWebSocket(user._id);}executeScroll();},[loading,isAuthenticated,connectWebSocket,executeScroll]);var send=function send(){if(msg===''){return;}var data={me:true,from:user._id,to:nowTalkingTo,time:new Date(),msg:msg};sendMessage(socket,data);//action 裡的function\nsetMsg('');};var handleKeyPress=function handleKeyPress(e){if(e.which===13){send();}};return/*#__PURE__*/React.createElement(\"div\",{className:\"mesgs\"},/*#__PURE__*/React.createElement(\"div\",{className:\"msg_history\"},msgData&&msgData.map(function(data,index){return data.me===true?/*#__PURE__*/React.createElement(Outgoing_msg,{msg:data.msg,key:data.toString()+index,time:data.time}):/*#__PURE__*/React.createElement(Incoming_msg,{msg:data.msg,key:data.toString()+index,time:data.time});}),/*#__PURE__*/React.createElement(\"div\",{ref:msgButton})),/*#__PURE__*/React.createElement(\"div\",{className:\"type_msg\"},/*#__PURE__*/React.createElement(\"div\",{className:\"input_msg_write\"},/*#__PURE__*/React.createElement(\"input\",{type:\"text\",className:\"write_msg\",value:msg,onChange:function onChange(e){setMsg(e.target.value);},onKeyPress:function onKeyPress(e){return handleKeyPress(e);},placeholder:\"Type a message\"}),/*#__PURE__*/React.createElement(\"button\",{className:\"msg_send_btn\",type:\"button\",onClick:send},/*#__PURE__*/React.createElement(\"i\",{className:\"fa fa-paper-plane-o\",\"aria-hidden\":\"true\"})))));};Mesgs.prototypes={msgData:PropTypes.object.isRequired,disconnectWebSocket:PropTypes.func.isRequired};var mapStateToProps=function mapStateToProps(state){return{user:state.auth.user,isAuthenticated:state.auth.isAuthenticated,socket:state.chat.socket,msgData:state.chat.msgData,loading:state.chat.loading,nowTalkingTo:state.chat.nowTalkingTo};};export default connect(mapStateToProps,{connectWebSocket:connectWebSocket,sendMessage:sendMessage,disconnectWebSocket:disconnectWebSocket})(Mesgs);","map":{"version":3,"sources":["/Users/andrew/mern-workspace/linkedUs/client/src/components/chat/Mesgs.js"],"names":["React","useEffect","useState","useRef","connect","PropTypes","connectWebSocket","sendMessage","disconnectWebSocket","Incoming_msg","Outgoing_msg","Mesgs","user","isAuthenticated","socket","msgData","loading","nowTalkingTo","ws","setWs","msg","setMsg","msgButton","executeScroll","current","scrollIntoView","_id","send","data","me","from","to","time","Date","handleKeyPress","e","which","map","index","toString","target","value","prototypes","object","isRequired","func","mapStateToProps","state","auth","chat"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useRef } from 'react';\nimport { connect } from 'react-redux';\nimport PropTypes from 'prop-types';\nimport {\n  connectWebSocket,\n  sendMessage,\n  disconnectWebSocket,\n} from '../../actions/chat';\nimport Incoming_msg from './Incoming_msg';\nimport Outgoing_msg from './Outgoing_msg';\n\nconst Mesgs = ({\n  user,\n  isAuthenticated,\n  socket,\n  msgData,\n  loading,\n  connectWebSocket,\n  sendMessage,\n  nowTalkingTo,\n}) => {\n  const [ws, setWs] = useState(null);\n  const [msg, setMsg] = useState('');\n\n  const msgButton = useRef(null);\n  const executeScroll = () => {\n    msgButton.current.scrollIntoView();\n  };\n\n  useEffect(() => {\n    if (loading && isAuthenticated) {\n      connectWebSocket(user._id);\n    }\n    executeScroll();\n  }, [loading, isAuthenticated, connectWebSocket, executeScroll]);\n\n  const send = () => {\n    if (msg === '') {\n      return;\n    }\n    const data = {\n      me: true,\n      from: user._id,\n      to: nowTalkingTo,\n      time: new Date(),\n      msg: msg,\n    };\n\n    sendMessage(socket, data); //action 裡的function\n\n    setMsg('');\n  };\n\n  const handleKeyPress = (e) => {\n    if (e.which === 13) {\n      send();\n    }\n  };\n  return (\n    <div className='mesgs'>\n      <div className='msg_history'>\n        {/*  */}\n\n        {msgData &&\n          msgData.map((data, index) =>\n            data.me === true ? (\n              <Outgoing_msg\n                msg={data.msg}\n                key={data.toString() + index}\n                time={data.time}\n              />\n            ) : (\n              <Incoming_msg\n                msg={data.msg}\n                key={data.toString() + index}\n                time={data.time}\n              />\n            )\n          )}\n\n        {/*  */}\n        <div ref={msgButton}></div>\n      </div>\n\n      <div className='type_msg'>\n        <div className='input_msg_write'>\n          {/* Input massage */}\n          <input\n            type='text'\n            className='write_msg'\n            value={msg}\n            onChange={(e) => {\n              setMsg(e.target.value);\n            }}\n            onKeyPress={(e) => handleKeyPress(e)}\n            placeholder='Type a message'\n          />\n\n          <button className='msg_send_btn' type='button' onClick={send}>\n            <i className='fa fa-paper-plane-o' aria-hidden='true'></i>\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nMesgs.prototypes = {\n  msgData: PropTypes.object.isRequired,\n  disconnectWebSocket: PropTypes.func.isRequired,\n};\n\nconst mapStateToProps = (state) => ({\n  user: state.auth.user,\n  isAuthenticated: state.auth.isAuthenticated,\n  socket: state.chat.socket,\n  msgData: state.chat.msgData,\n  loading: state.chat.loading,\n  nowTalkingTo: state.chat.nowTalkingTo,\n});\n\nexport default connect(mapStateToProps, {\n  connectWebSocket,\n  sendMessage,\n  disconnectWebSocket,\n})(Mesgs);\n"]},"metadata":{},"sourceType":"module"}